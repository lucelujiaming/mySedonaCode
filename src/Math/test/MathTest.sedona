//
// Copyright (c) 2007 Tridium, Inc
// Licensed under the Academic Free License version 3.0
//
// History:
//   16 May 07  Andy Sunders  Creation
//

**
** MathTest
**
class MathTest
  extends SSTest
{
  static inline Min min
  static inline Max max
  static inline SequenceMinMax seqMinMax
  static inline FloatOffset foff
  static inline Round rnd

  static void test()
  {

    min.in1 := 10f
    min.in2 := 9f
    min.execute()
    assert(min.out == 9f)

    min.in1 := -8f
    min.in2 := -9f
    min.execute()
    assert(min.out == -9f)

    max.in1 := 10f
    max.in2 := 9f
    max.execute()
    assert(max.out == 10f)

    max.in1 := -8f
    max.in2 := -9f
    max.execute()
    assert(max.out == -8f)

    validateMinMax()

    foff.offset := 1.0f
    foff.in := 2.0f
    foff.execute()
    assert(foff.out == 3.0f)
    foff.in := -1.0f
    foff.execute()
    assert(foff.out == 0.0f)

    rnd.start()
    doRound(3.56723, 1, 3.6)
    doRound(-3.56723, 1, -3.6)
    doRound(3.56723, 2, 3.57)
    doRound(-3.56723, 2, -3.57)
    doRound(3.56723, 3, 3.567)
    doRound(-3.56723, 3, -3.567)
  }




  static void doMinMax(float f)
  {
    seqMinMax.in := f
    seqMinMax.execute()
  }

  static void checkMinMax(float n, float x)
  {
    assert(seqMinMax.minOut == n)
    assert(seqMinMax.maxOut == x)
  }


  static void validateMinMax()
  {
    waitForSteadyState()

    seqMinMax.reset()
    doMinMax(10f)
    checkMinMax(10f, 10f)       // 1

    doMinMax(9f)
    checkMinMax(9f, 10f)        // 2

    doMinMax(0f)
    doMinMax(-1f)
    doMinMax(-1000f)
    doMinMax(0f)
    doMinMax(1f)
    doMinMax(1000f)
    checkMinMax(-1000f, 1000f)  // 3

    seqMinMax.reset()
    seqMinMax.execute()
    checkMinMax(1000f, 1000f)   // 4

    doMinMax(1f)
    doMinMax(-10f)
    checkMinMax(-10f, 1000f)    // 5
  }


  static void doRound(float val, int places, float checkVal)
  {
    rnd.in := val
    rnd.decimalPlaces := places
    rnd.execute()
    assert(rnd.out == checkVal)
  }

}
